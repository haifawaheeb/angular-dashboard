<div class="page-container">


  <div class="top-bar">
    <button class="btn-new" (click)="openDialog()">
      <span>ุฌูุณุฉ ุฌุฏูุฏุฉ</span>
    </button>
  </div>

  <div class="filter-bar">
    <input type="text" [(ngModel)]="search" (input)="applyFilter()" placeholder="ุจุญุซ ุนู ุฌูุณุฉ..." />
  </div>

  <div class="table-wrapper">
    <table>
      <thead>
        <tr>
          <!-- <th>#</th> -->
          <th>ุงูุญุตุฉ ุงูุฒูููุฉ</th>
          <th>ุงูุฏุฑุณ</th>
          <th>ุชุงุฑูุฎ ุงูุฌูุณุฉ</th>
          <th>ุจุฏุงูุฉ ูุนููุฉ</th>
          <th>ููุงูุฉ ูุนููุฉ</th>
          <th>ุชุนุฏูู</th>
          <th>ุญุฐู</th>
        </tr>
      </thead>

      <tbody>
        @for (s of filtered; track s.id) {
        <tr>
          <!-- <td>{{ s.id }}</td> -->
          <td>{{ getSlotLabel(s.timetable_slot) }}</td>
          <td>{{ getLessonName(s.lesson ?? '') }}</td>
          <td>{{ s.session_date }}</td>
          <td>{{ formatDateTime(s.actual_start) }}</td>
          <td>{{ formatDateTime(s.actual_end) }}</td>
          <td>
            <button class="icon-btn-table edit" (click)="edit(s)">โ</button>
          </td>

          <td>
            <button class="icon-btn-table delete" (click)="delete(s.id!)">๐</button>
          </td>
        </tr>
        }
      </tbody>
    </table>
  </div>
</div>

@if (isDialogOpen) {
<div class="dialog-overlay" (click)="closeDialog()">
  <div class="dialog-box" (click)="$event.stopPropagation()">

    <div class="dialog-header">
      <button class="close-btn" (click)="closeDialog()">โ</button>
      <h3>{{ dialogTitle }}</h3>
    </div>

    <form [formGroup]="form" class="dialog-body">

      <div class="form-grid">
        <div class="form-col">

          <label>ุงูุญุตุฉ ุงูุฒูููุฉ</label>
          <select formControlName="timetable_slot_id">
            <option value="" disabled>ุงุฎุชุฑ ุงูุญุตุฉ</option>
            @for (slot of timetableSlots; track slot.id) {
            <option [value]="slot.id">{{ slotLabel(slot) }}</option>
            }
          </select>

          <label>ุงูุฏุฑุณ</label>
          <select formControlName="lesson_id">
            <option value="">ุจุฏูู (ุงุฎุชูุงุฑู)</option>
            @for (l of lessons; track l.id) {
            <option [value]="l.id">{{ l.title_ar ?? l.title ?? l.name_ar ?? l.name ?? l.id }}</option>
            }
          </select>

          <label>ุชุงุฑูุฎ ุงูุฌูุณุฉ</label>
          <input type="date" formControlName="session_date" />

        </div>

        <div class="form-col">
          <label>ุงูุจุฏุงูุฉ ุงููุนููุฉ (ุชุงุฑูุฎ)</label>
          <input type="date" formControlName="actual_start_date" />

          <label>ุงูุจุฏุงูุฉ ุงููุนููุฉ (ููุช)</label>
          <input type="time" formControlName="actual_start_time" />

          <label>ุงูููุงูุฉ ุงููุนููุฉ (ุชุงุฑูุฎ)</label>
          <input type="date" formControlName="actual_end_date" />

          <label>ุงูููุงูุฉ ุงููุนููุฉ (ููุช)</label>
          <input type="time" formControlName="actual_end_time" />
        </div>
      </div>

      <div class="footer-buttons">
        <button type="button" class="btn-save" (click)="save()">๐พ ุญูุธ</button>
        <button type="button" class="btn-exit" (click)="closeDialog()">โ ุฎุฑูุฌ</button>
      </div>

    </form>

  </div>
</div>
}
